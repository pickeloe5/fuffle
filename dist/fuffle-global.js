var fuffle;(()=>{"use strict";var __webpack_modules__={22:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>BindingBase,Z:()=>Binding});var _util_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(891);class BindingBase{#t=[];observer=null;constructor(t=null){this.observer=t}start(t=this.observer){return this.observer=t,this.runTracked(),t.addEventListener("write",this.#e),this}onStop(){}stop(){return this.observer?.removeEventListener("write",this.#e),this.onStop(),this}run(){}onRun(t){}runTracked(){const t=this.observer.trackReads(),e=this.run.call(this.observer.proxy);this.#t=t(),this.onRun(e)}#e=({propertyPath:t})=>{this.#t.some((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.pathEquals)(t))&&this.runTracked()}}class Binding extends BindingBase{state={js:"",locals:null};constructor(t){super(),t&&(this.state.js=t),this.run=this.#r()}withLocals(t={}){return this.state.locals=t,this}withJs(t){return this.state.js=t,this.observer&&this.runTracked(),this}#r(){const{state}=this;return function(){let js="";if(state.locals)for(const t in state.locals)js+=`const ${t}=state.locals.${t}?.();`;return eval(js+state.js)}}}},891:(t,e,r)=>{r.r(e),r.d(e,{EventName:()=>i,ProviderElement:()=>n,pathEquals:()=>s});const s=t=>e=>{if(e.length!==t.length)return!1;for(let r in t)if(e[r]!==t[r])return!1;return!0};class n extends HTMLElement{}const i={ATTRIBUTE_CHANGED:"fuffle-attribute-changed"}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Binding:()=>s.Z,BindingBase:()=>s.O,Component:()=>i,ComponentBase:()=>n,ComponentElement:()=>a,FuffleFor:()=>_,FuffleIf:()=>p,Observer:()=>r,Template:()=>o,TemplateInstance:()=>h,util:()=>t});var t=__webpack_require__(891);class e{static instance=new e}class r extends EventTarget{static resolve(t){return t&&t instanceof e?t.observer:null}static fromArray(t){const e=r.resolve(t);return Array.isArray(e?.target)?e:null}target=null;proxy=null;#s=null;parent=null;#n=null;constructor(t,e=!1){if(super(),this.target=t,!e){this.#n={};for(const e in t)this.#i(e)}this.proxy=this.#a()}withParent(t,e){return this.parent=t,this.#s=e,this}#o=null;trackReads(){if(this.#o)throw new Error("Concurrent modification exception");return this.#o=[],this.#h}#h=()=>{const t=[...this.#o];return this.#o=null,t};onRead(e){this.#o&&!this.#o.includes((0,t.pathEquals)(e))&&this.#o.push(e),this.parent?.onRead([this.#s,...e])}onWrite(t,e){const r=new Event("write");r.propertyPath=t,r.propertyValue=e,this.dispatchEvent(r),this.parent?.onWrite([this.#s,...t],e)}#i(t,e=this.target[t]){this.#n&&(e&&"object"==typeof e&&e!==this?this.#n[t]=new r(e).withParent(this,t):this.#n.hasOwnProperty(t)&&(this.#n[t].parent=null,delete this.#n[t]))}#a(){return new Proxy(this.target,{getPrototypeOf:t=>e.instance,get:(t,e,r)=>{if("observer"===e)return this;let s;return s=this.#n?.hasOwnProperty(e)?this.#n[e].proxy:Reflect.get(t,e,r),"function"==typeof s&&(s=s.bind(r)),this.onRead([e]),s},set:(t,e,r,s)=>{const n=Reflect.set(t,e,r,s);return this.#i(e,r),this.onWrite([e],r),n}})}}var s=__webpack_require__(22);class n{static getObserver(t){return null}static defineElement(t){const e=this,r=class extends a{static ComponentImpl=e;static isProvider=!!e.isProvider};return customElements.define(t,r),r}constructor(t){}onConnected(){}onAttributeChanged(t,e){}onDisconnected(){}}class i extends n{static getObserver(t){return t.#l}static template=null;#c=null;#l=null;#u=this.constructor.template?.bake();constructor(t){super(t),this.#c=t}onConnected(){this.#l=new r(this),this.#u?.withParent(this.#c).start(this.#l)}onDisconnected(){this.#u?.stop()}}class a extends HTMLElement{static getInstance(t){return t.#d}static getObserver(t){const e=this.getInstance(t);if(!e)return null;const r=e.constructor?.getObserver(e);return r||null}static getParent(t){for(;t=t.parentNode;)if(t instanceof this)return this.getObserver(t);return null}static ComponentImpl=null;static isProvider=!1;static get observedAttributes(){return this.ComponentImpl.Attribute?Object.values(this.ComponentImpl.Attribute):[]}#d;constructor(){super(),this.#d=new this.constructor.ComponentImpl(this),this.addEventListener(t.EventName.ATTRIBUTE_CHANGED,this.#p)}#p=({attributeName:t,attributeValue:e})=>{this.#d.onAttributeChanged(t,e)};connectedCallback(){this.isConnected&&setTimeout((()=>{this.#d.onConnected(a.getParent(this))}),0)}disconnectedCallback(){this.#d.onDisconnected()}attributeChangedCallback(t,e,r){this.#d.onAttributeChanged(t,r)}}class o{static Text={SHALLOW:"shallow",DEEP:"deep"};static Attribute={TEXT:"data-f-text",VALUE:"data-f-value"};static Prefix={ATTRIBUTE:"data-f:",ATTRIBUTE_STRING:"data-f-s:",EVENT:"data-f-on:"};static fromNode(t){return new o([...t.content.childNodes],o.getTextMode(t))}static getTextMode(t,e=!1){let r=!1;return t.hasAttribute(o.Attribute.TEXT)&&(r=t.getAttribute(o.Attribute.TEXT)===o.Text.SHALLOW?o.Text.SHALLOW:o.Text.DEEP),r||e===o.Text.SHALLOW||(r=e),r}#n=[];#_=!1;constructor(t,e=!1){this.#n=t,this.#_=e}bake(){return new h(this.#n.map((t=>t.cloneNode(!0))),this.#_)}}class h{#_;#b=null;#m=[];#f=null;children=[];constructor(t,e){this.children=t,this.#_=e}withParent(t){this.#f=t;for(const e of this.children)t.appendChild(e);return this}withLocals(t){return this.#b=t,this}start(t){this.#v(this.children,this.#_);for(const e of this.#m)e.start(t);return this}stop(){for(const t of this.#m)t.stop();return this}withoutParent(){if(this.#f)for(const t of this.children)this.#f.removeChild(t);return this.#f=null,this}#v(t,e){for(const r of t)switch(r.nodeType){case Node.TEXT_NODE:this.#w(r,e);break;case Node.ELEMENT_NODE:this.#g(r,e)}}#w(t,e){if(!e)return;const r=t.nodeValue;t.nodeValue="",this.#m.push(new l(t,r).withLocals(this.#b))}#g(t,e){for(const e of t.getAttributeNames())this.#E(t,e);t instanceof a||this.#v(t.childNodes,o.getTextMode(t,e))}#E(t,e){if(e===o.Attribute.VALUE)return void this.#m.push(new d(t,t.getAttribute(e)));const[r,s]=this.#T(e);if(!r)return;const n=t.getAttribute(e);switch(r===o.Prefix.ATTRIBUTE_STRING&&t.removeAttribute(e),r){case o.Prefix.ATTRIBUTE:this.#m.push(new c(t,s,n).withLocals(this.#b));break;case o.Prefix.ATTRIBUTE_STRING:this.#m.push(new c(t,s,n,!0).withLocals(this.#b));break;case o.Prefix.EVENT:this.#m.push(new u(t,s,n).withLocals(this.#b))}}#T(t){for(const e of Object.values(o.Prefix))if(t.startsWith(e))return[e,t.substring(e.length)];return["",t]}}class l extends s.Z{#A=null;constructor(t,e=""){super(`\`${e}\``),this.#A=t}onRun(t){this.#A.nodeValue=t}}class c extends s.Z{#A=null;#s="";#x=!1;constructor(t,e,r,s=!1){super(r),this.#A=t,this.#s=e,this.#x=!!s}onRun(e){this.#x&&this.#A.setAttribute(this.#s,e);const r=new Event(t.EventName.ATTRIBUTE_CHANGED);r.attributeName=this.#s,r.attributeValue=e,this.#A.dispatchEvent(r)}}class u extends s.Z{#A=null;#s="";#k=null;constructor(t,e,r){super(r),this.#A=t,this.#s=e}onStop(){this.#k&&this.#A.removeEventListener(this.#s,this.#k)}onRun(t){this.onStop(),this.#A.addEventListener(this.#s,t),this.#k=t}}class d extends s.Z{#A=null;constructor(t,e){super(e),this.#A=t}onRun(t){this.#A.value=t}}class p extends n{static Attribute={CONDITION:"data-condition"};#O=null;#c=null;#C=null;#u=null;#k=!1;constructor(t){super(t),this.#c=t,this.#u=new h([...t.childNodes].map((t=>t.cloneNode(!0)))),this.#C=t.attachShadow({mode:"open"})}onDisconnected(){this.#u.stop()}onConnected(t){this.#O=t,this.#k&&this.#y()}#y(){this.#O&&this.#u.withParent(this.#C).start(this.#O)}#P(){this.#u.stop().withoutParent()}onAttributeChanged(t,e){t===p.Attribute.CONDITION&&(e=!!e)!==this.#k&&(this.#k=e,e?this.#y():this.#P())}}p.defineElement("fuffle-if");class _ extends n{static Attribute={ARRAY:"data-array",NAME:"data-name"};#O=null;#N=null;#c=null;#C=null;#u=null;#n=[];#L="it";constructor(t){super(t),this.#c=t,this.#C=t.attachShadow({mode:"open"}),this.#u=new o([...t.childNodes])}onDisconnected(){for(this.#N?.removeEventListener("write",this.#e);this.#n.length;)this.#R()}onConnected(t){this.#O=t,this.#I()}onAttributeChanged(t,e){switch(t){case _.Attribute.NAME:this.#B(e);break;case _.Attribute.ARRAY:this.#D(e)}}#B(t){this.#L=t;for(const t in this.#n)this.#n[t].withLocals(this.#S(t))}#D(t){for(this.#N?.removeEventListener("write",this.#e);this.#n.length;)this.#R();this.#N=r.fromArray(t),this.#I()}#I(){if(this.#N&&this.#O){for(const t in this.#N.target)this.#M(t);this.#N.addEventListener("write",this.#e)}}#e=({propertyPath:t,propertyValue:e})=>{if(1===t.length&&"length"===t[0]&&e!==this.#n.length){for(let t=this.#n.length;t<e;t++)this.#M(t);for(let t=this.#n.length-1;t>=e;t--)this.#R()}};#M(t,e=this.#N.target[t]){this.#n.push(this.#u.bake().withLocals(this.#S(t)).withParent(this.#C).start(this.#O))}#R(){this.#n.pop().stop().withoutParent()}#S(t){return{[this.#L]:()=>this.#N.proxy[t]}}}_.defineElement("fuffle-for")})(),fuffle=__webpack_exports__})();