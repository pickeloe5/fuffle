var fuffle;(()=>{"use strict";var __webpack_modules__={22:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>BindingBase,Z:()=>Binding});var _util_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(891);class BindingBase{#t=[];observer=null;constructor(t=null){this.observer=t}start(t=this.observer){return this.observer=t,this.runTracked(),t.addEventListener("write",this.#e),this}onStop(){}stop(){return this.observer?.removeEventListener("write",this.#e),this.onStop(),this}run(){}withRun(t){return this.run=t,this}onRun(t){}withOnRun(t){return this.onRun=t,this}runTracked(){const t=this.observer.trackReads(),e=this.run.call(this.observer.proxy);this.#t=t(),this.onRun(e)}#e=({propertyPath:t})=>{this.#t.some((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.pathEquals)(t))&&this.runTracked()}}class Binding extends BindingBase{state={js:"",locals:null};constructor(t){super(),t&&(this.state.js=t),this.run=this.#s()}withLocals(t={}){return this.state.locals=t,this}withJs(t){return this.state.js=t,this.observer&&this.runTracked(),this}#s(){const{state}=this;return function(){let js="";if(state.locals)for(const t in state.locals)js+=`const ${t}=state.locals.${t}?.();`;return eval(js+state.js)}}}},891:(t,e,s)=>{s.r(e),s.d(e,{EventName:()=>i,ProviderElement:()=>r,pathEquals:()=>n});const n=t=>e=>{if(e.length!==t.length)return!1;for(let s in t)if(e[s]!==t[s])return!1;return!0};class r extends HTMLElement{}const i={ATTRIBUTE_CHANGED:"fuffle-attribute-changed"}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}__webpack_require__.d=(t,e)=>{for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Binding:()=>n.Z,BindingBase:()=>n.O,Component:()=>i,ComponentBase:()=>r,ComponentElement:()=>a,FuffleFor:()=>_,FuffleIf:()=>p,Observer:()=>s,Template:()=>o,TemplateInstance:()=>h,util:()=>t});var t=__webpack_require__(891);class e{static instance=new e}class s extends EventTarget{static resolve(t){return t&&t instanceof e?t.observer:null}static fromArray(t){const e=s.resolve(t);return Array.isArray(e?.target)?e:null}target=null;proxy=null;#n=null;parent=null;#r=null;constructor(t,e=!1){if(super(),this.target=t,!e){this.#r={};for(const e in t)this.#i(e)}this.proxy=this.#a()}withParent(t,e){return this.parent=t,this.#n=e,this}#o=null;trackReads(){if(this.#o)throw new Error("Concurrent modification exception");return this.#o=[],this.#h}#h=()=>{const t=[...this.#o];return this.#o=null,t};onRead(e){this.#o&&!this.#o.includes((0,t.pathEquals)(e))&&this.#o.push(e),this.parent?.onRead([this.#n,...e])}onWrite(t,e){const s=new Event("write");s.propertyPath=t,s.propertyValue=e,this.dispatchEvent(s),this.parent?.onWrite([this.#n,...t],e)}#i(t,e=this.target[t]){this.#r&&(e&&"object"==typeof e&&e!==this?this.#r[t]=new s(e).withParent(this,t):this.#r.hasOwnProperty(t)&&(this.#r[t].parent=null,delete this.#r[t]))}#a(){return new Proxy(this.target,{getPrototypeOf:t=>e.instance,get:(t,e,s)=>{if("observer"===e)return this;let n;return n=this.#r?.hasOwnProperty(e)?this.#r[e].proxy:Reflect.get(t,e,s),"function"==typeof n&&(n=n.bind(s)),this.onRead([e]),n},set:(t,e,s,n)=>{const r=Reflect.set(t,e,s,n);return this.#i(e,s),this.onWrite([e],s),r}})}}var n=__webpack_require__(22);class r{static getObserver(t){return null}static defineElement(t){const e=this,s=class extends a{static ComponentImpl=e;static isProvider=!!e.isProvider};return customElements.define(t,s),s}constructor(t){}onConnected(){}onAttributeChanged(t,e){}onDisconnected(){}}class i extends r{static getObserver(t){return t.#l}static template=null;#c=null;#l=null;#u=this.constructor.template?.bake();constructor(t){super(t),this.#c=t}onConnected(){if(this.#l=new s(this),!this.#u){const t=[...this.#c.childNodes];for(const e of t)this.#c.removeChild(e);this.#u=new h(t)}this.#u.withParent(this.#c).start(this.#l)}onDisconnected(){this.#u.stop().withoutParent()}}class a extends HTMLElement{static getInstance(t){return t.#d}static getObserver(t){const e=this.getInstance(t);if(!e)return null;const s=e.constructor?.getObserver(e);return s||null}static getParent(t){for(;t=t.parentNode;)if(t instanceof this)return this.getObserver(t);return null}static ComponentImpl=null;static isProvider=!1;static get observedAttributes(){return this.ComponentImpl.Attribute?Object.values(this.ComponentImpl.Attribute):[]}#d;constructor(){super(),this.#d=new this.constructor.ComponentImpl(this),this.addEventListener(t.EventName.ATTRIBUTE_CHANGED,this.#p)}#p=({attributeName:t,attributeValue:e})=>{this.#d.onAttributeChanged(t,e)};connectedCallback(){this.isConnected&&setTimeout((()=>{this.#d.onConnected(a.getParent(this))}),0)}disconnectedCallback(){this.#d.onDisconnected()}attributeChangedCallback(t,e,s){this.#d.onAttributeChanged(t,s)}}class o{static Text={SHALLOW:"shallow",DEEP:"deep"};static Attribute={TEXT:"data-f-text",VALUE:"data-f-value"};static Prefix={ATTRIBUTE:"data-f:",ATTRIBUTE_STRING:"data-f-s:",EVENT:"data-f-on:"};static fromNode(t){return new o([...t.content.childNodes],o.getTextMode(t))}static getTextMode(t,e=!1){let s=!1;return t.hasAttribute(o.Attribute.TEXT)&&(s=t.getAttribute(o.Attribute.TEXT)===o.Text.SHALLOW?o.Text.SHALLOW:o.Text.DEEP),s||e===o.Text.SHALLOW||(s=e),s}#r=[];#_=!1;constructor(t,e=!1){this.#r=t,this.#_=e}bake(){return new h(this.#r.map((t=>t.cloneNode(!0))),this.#_)}}class h{#_;#b=null;#m=[];#f=null;children=[];constructor(t,e){this.children=t,this.#_=e}withParent(t){this.#f=t;for(const e of this.children)t.appendChild(e);return this}withLocals(t){return this.#b=t,this}start(t){this.#v(this.children,this.#_);for(const e of this.#m)e.start(t);return this}stop(){for(const t of this.#m)t.stop();return this}withoutParent(){if(this.#f)for(const t of this.children)this.#f.removeChild(t);return this.#f=null,this}#v(t,e){for(const s of t)switch(s.nodeType){case Node.TEXT_NODE:this.#w(s,e);break;case Node.ELEMENT_NODE:this.#g(s,e)}}#w(t,e){if(!e)return;const s=t.nodeValue;t.nodeValue="",this.#m.push(new l(t,s).withLocals(this.#b))}#g(t,e){for(const e of t.getAttributeNames())this.#E(t,e);t instanceof a||this.#v(t.childNodes,o.getTextMode(t,e))}#E(t,e){if(e===o.Attribute.VALUE)return void this.#m.push(new d(t,t.getAttribute(e)));const[s,n]=this.#T(e);if(!s)return;const r=t.getAttribute(e);switch(s===o.Prefix.ATTRIBUTE_STRING&&t.removeAttribute(e),s){case o.Prefix.ATTRIBUTE:this.#m.push(new c(t,n,r).withLocals(this.#b));break;case o.Prefix.ATTRIBUTE_STRING:this.#m.push(new c(t,n,r,!0).withLocals(this.#b));break;case o.Prefix.EVENT:this.#m.push(new u(t,n,r).withLocals(this.#b))}}#T(t){for(const e of Object.values(o.Prefix))if(t.startsWith(e))return[e,t.substring(e.length)];return["",t]}}class l extends n.Z{#A=null;constructor(t,e=""){super(`\`${e}\``),this.#A=t}onRun(t){this.#A.nodeValue=t}}class c extends n.Z{#A=null;#n="";#x=!1;constructor(t,e,s,n=!1){super(s),this.#A=t,this.#n=e,this.#x=!!n}onRun(e){this.#x&&this.#A.setAttribute(this.#n,e);const s=new Event(t.EventName.ATTRIBUTE_CHANGED);s.attributeName=this.#n,s.attributeValue=e,this.#A.dispatchEvent(s)}}class u extends n.Z{#A=null;#n="";#k=null;constructor(t,e,s){super(s),this.#A=t,this.#n=e}onStop(){this.#k&&this.#A.removeEventListener(this.#n,this.#k)}onRun(t){this.onStop(),this.#A.addEventListener(this.#n,t),this.#k=t}}class d extends n.Z{#A=null;constructor(t,e){super(e),this.#A=t}onRun(t){this.#A.value=t}}class p extends r{static Attribute={CONDITION:"data-condition"};#O=null;#c=null;#C=null;#u=null;#k=!1;constructor(t){super(t),this.#c=t,this.#u=new h([...t.childNodes].map((t=>t.cloneNode(!0)))),this.#C=t.attachShadow({mode:"open"})}onDisconnected(){this.#u.stop()}onConnected(t){this.#O=t,this.#k&&this.#y()}#y(){this.#O&&this.#u.withParent(this.#C).start(this.#O)}#P(){this.#u.stop().withoutParent()}onAttributeChanged(t,e){t===p.Attribute.CONDITION&&(e=!!e)!==this.#k&&(this.#k=e,e?this.#y():this.#P())}}p.defineElement("fuffle-if");class _ extends r{static Attribute={ARRAY:"data-array",NAME:"data-name"};#O=null;#N=null;#c=null;#C=null;#u=null;#r=[];#R="it";constructor(t){super(t),this.#c=t,this.#C=t.attachShadow({mode:"open"}),this.#u=new o([...t.childNodes])}onDisconnected(){for(this.#N?.removeEventListener("write",this.#e);this.#r.length;)this.#L()}onConnected(t){this.#O=t,this.#I()}onAttributeChanged(t,e){switch(t){case _.Attribute.NAME:this.#B(e);break;case _.Attribute.ARRAY:this.#D(e)}}#B(t){this.#R=t;for(const t in this.#r)this.#r[t].withLocals(this.#S(t))}#D(t){for(this.#N?.removeEventListener("write",this.#e);this.#r.length;)this.#L();this.#N=s.fromArray(t),this.#I()}#I(){if(this.#N&&this.#O){for(const t in this.#N.target)this.#M(t);this.#N.addEventListener("write",this.#e)}}#e=({propertyPath:t,propertyValue:e})=>{if(1===t.length&&"length"===t[0]&&e!==this.#r.length){for(let t=this.#r.length;t<e;t++)this.#M(t);for(let t=this.#r.length-1;t>=e;t--)this.#L()}};#M(t,e=this.#N.target[t]){this.#r.push(this.#u.bake().withLocals(this.#S(t)).withParent(this.#C).start(this.#O))}#L(){this.#r.pop().stop().withoutParent()}#S(t){return{[this.#R]:()=>this.#N.proxy[t]}}}_.defineElement("fuffle-for")})(),fuffle=__webpack_exports__})();